<% layout('layouts/boilerplate.ejs') %>

<div id="cluster-map"></div>

<div class="container">
    <h1>All Campgrounds</h1>
    <div>
        <a class="btn btn-success mb-3" href="/campgrounds/new">Add Campground</a>
    </div>

    <% for (let campground of campgrounds) { %>
        <div class="card mb-3">
            <div class="row">
                <div class="col-md-4">
                    <% if (campground.images.length) { %>
                        <img crossorigin="anonymous" class="img-fluid" alt="" src="<%= campground.images[0].url %>">
                    <% } else { %>
                        <img crossorigin="anonymous" class="img-fluid" alt=""
                            src="https://res.cloudinary.com/dfrh9yo3s/image/upload/v1760355786/yelpCamp/xjesljhv5oixit4nc1sd.jpg">
                    <% } %>
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title"><%= campground.title %></h5>
                        <p class="card-text"><%= campground.description %></p>
                        <p class="card-text">
                            <small class="text-muted"><%= campground.location %></small>
                        </p>
                        <a class="btn btn-primary" href="/campgrounds/<%= campground._id %>">
                            View <%= campground.title %>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    <% } %>
</div>

<%- "<script>" %>
    const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";

    const campgrounds = {
        type: "FeatureCollection",
        features: <%- JSON.stringify(
            campgrounds.map(campground => ({
                type: "Feature",
                geometry: campground.geometry,
                properties: { popUpMarkup: campground?.properties?.popUpMarkup }
            }))
        ) %>
    };
<%- "</script>" %>

<script src="/javascript/clusterMap.js"></script>
    